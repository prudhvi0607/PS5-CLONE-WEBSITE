/*!
 * @sie/designkit
 * @copyright     2024 Sony Interactive Entertainment LLC, all rights reserved
 */

!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,n(a.key),a)}}function i(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function n(t){var e=a(t,"string");return"symbol"==typeof e?e:String(e)}var r=({IS_PORTRAIT:(window.matchMedia&&matchMedia("(orientation: portrait)")||{}).matches,IS_LANDSCAPE:(window.matchMedia&&matchMedia("(orientation: landscape)")||{}).matches,IS_MOBILE:(window.matchMedia&&matchMedia("(max-width: 767px)")||{}).matches,IS_MOBILE_PORTRAIT:(window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{}).matches,IS_TABLET:(window.matchMedia&&matchMedia("(min-width: 768px)")||{}).matches,IS_DESKTOP:(window.matchMedia&&matchMedia("(min-width: 1024px)")||{}).matches},{IS_PORTRAIT:window.matchMedia&&matchMedia("(orientation: portrait)")||{},IS_LANDSCAPE:window.matchMedia&&matchMedia("(orientation: landscape)")||{},IS_JETSTREAM_MOBILE:window.matchMedia&&matchMedia("(max-width: 699px)")||{},IS_MOBILE:window.matchMedia&&matchMedia("(max-width: 767px)")||{},IS_MOBILE_PORTRAIT:window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{},IS_TABLET:window.matchMedia&&matchMedia("(min-width: 768px)")||{},IS_TABLET_LG:window.matchMedia&&matchMedia("(min-width: 1024px)")||{},IS_LAPTOP:window.matchMedia&&matchMedia("(min-width: 1367px)")||{},IS_DESKTOP:window.matchMedia&&matchMedia("(min-width: 1920px)")||{},IS_MAX_TABLET:window.matchMedia&&matchMedia("(max-width: 1023px)")||{},IS_JUST_TABLET:window.matchMedia&&matchMedia("(min-width: 768px) and (max-width: 1365px)")||{},IS_JUST_LAPTOP:window.matchMedia&&matchMedia("(min-width: 1366px) and (max-width: 1919px)")||{}}),o=({IS_PORTRAIT:r.IS_PORTRAIT.matches,IS_LANDSCAPE:r.IS_LANDSCAPE.matches,IS_JETSTREAM_MOBILE:r.IS_JETSTREAM_MOBILE.matches,IS_MOBILE:r.IS_MOBILE.matches,IS_MOBILE_PORTRAIT:r.IS_MOBILE_PORTRAIT.matches,IS_TABLET:r.IS_TABLET.matches,IS_MAX_TABLET:r.IS_MAX_TABLET.matches,IS_TABLET_LG:r.IS_TABLET_LG.matches,IS_LAPTOP:r.IS_LAPTOP.matches,IS_DESKTOP:r.IS_DESKTOP.matches},{EMPTY_LABEL:"empty"}),c="javascript:void(0);",s=function(t,e,i){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=e.offset().top,r=400;a&&(r=800,window.scrollTo(0,t.offset().top)),t.animate({scrollTop:n},{duration:r,step:function(t,i){var a=e.offset().top;i.end!=a&&(i.end=a)}}).animate({scrollTop:n-i},{duration:200,step:function(t,a){var n=e.offset().top-i;a.end!=n&&(a.end=n)}})},d=function(t,e){return e?e.find(t):$(t)},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--gradient-start",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--gradient-end",a=t.get(0),n=t.data(),r=n.solidBgColor,o=n.gradientStart,c=n.gradientEnd,s="",d="";if(r&&!o)s=r,d=r;else{if(!o||!c)return;s=o,d=c}a.style.setProperty(e,s),a.style.setProperty(i,d)},h=function(t){return t.toString().trim().replace(/[^a-z-_0-9]/gi,"")},u=function(t){return!(!t||t===c)},m=function(){function e(i){t(this,e),this.$context=i,this.selector='div[data-component="accordion"], div[data-component="accordion-expandable-content"], div[data-component="accordion__hero"], form[data-component="accordion"]'}return i(e,[{key:"triggerAccordion",value:function(t,e){var i=this,a=t.children("div:not(.accordion__item-title)"),n=t.find(".accordion__item-title"),r=t.find(".accordion__item-description"),o=n.find(".chevron"),c=e.data("item-open"),s=e.data("item-closed"),d=e.find(".link"),l=e.data("dtm-label")||d.text(),h=e.next(),u=n.index(e)+1,m=t.data("aria-label-down");if(e.hasClass("active"))h.slideUp("300",function(){if(e.attr("aria-expanded","false").removeClass("active"),a.length&&e.parent().removeClass("active-wrapper"),o.length){var n=e.find(".chevron");n.toggleClass("chevron-up"),s&&d.text(s),n.find("svg").first().attr("aria-label",m)}i.logAccordionDtmEvent(t,l,u,"close")});else{if(o.length){o.removeClass("chevron-up"),$.each(o,function(t,e){$(e).find("svg").first().attr("aria-label",m)});var f=e.find(".chevron");f.toggleClass("chevron-up"),f.find("svg").first().attr("aria-label",t.data("aria-label-up"))}r.slideUp("300").promise().done(function(){var r=n.filter(".active"),o=r.find(".link"),s=r.data("dtm-label")||o.text(),m=n.index(r)+1,f=r.data("item-closed");r&&r.length&&(f&&o.text(f),i.logAccordionDtmEvent(t,s,m,"close")),n.attr("aria-expanded","false").removeClass("active"),e.attr("aria-expanded","true").addClass("active"),a.length&&(a.removeClass("active-wrapper"),e.parent().addClass("active-wrapper")),c&&d.text(c),h.slideDown("300",function(){i.logAccordionDtmEvent(t,l,u,"open")})})}}},{key:"addClickHandlerForAccordions",value:function(){var t=this,e=d(this.selector,this.$context);e&&e.length&&$.each(e,function(e,i){var a=$(i),n=a.find(".accordion__item-title").filter(function(e,i){return $(i).closest(t.selector).is(a)});n.on("click.dkAccordion",function(e){var i=e.currentTarget;t.triggerAccordion(a,$(i))})})}},{key:"logAccordionDtmEvent",value:function(t,e,i,a){_gpdc.analytics.event.addGDLEvent("click",a+" accordion",{moduleName:"accordion",elementType:"button",assetName:o.EMPTY_LABEL,linkUrl:o.EMPTY_LABEL,label:e,userActionFlag:!0,position:1},t),_gpdc.analytics._satelliteTrack("user_engagement")}},{key:"init",value:function(){this.addClickHandlerForAccordions(),_gpdc.Logger.logInitializer("accordion","components","Accordions")}}]),e}(),f=function(){function e(){t(this,e),this.$els={win:_gpdc.elements.$window,html:$("html"),htmlBody:$("html, body"),dkNav:$("#sony-bar.dk-nav__wrapper"),nav:$("#shared-nav-root #shared-nav-container"),tertiary:$("#jetstream-tertiary-nav .tertiary-container")},this.EVENT_CHANGE="hashchange.dkHashAnchor",this.EVENT_LOAD="load.dkHashAnchor",this.EVENT_CLICK="click.dkHashAnchor",this.pageLoad=!0,this.hashRegex=new RegExp("^#")}return i(e,[{key:"bind",value:function(){this.onHashChange=this.onHashChange.bind(this),this.onHashAnchorClick=this.onHashAnchorClick.bind(this)}},{key:"init",value:function(){var t=this;this.$els.win.on(this.EVENT_CHANGE,this.onHashChange),"complete"===document.readyState?(window.scrollTo(0,0),this.highlightTertiaryLink(),this.$els.win.trigger(this.EVENT_CHANGE)):this.$els.win.on(this.EVENT_LOAD,function(){return window.scrollTo(0,0),t.highlightTertiaryLink(),t.$els.win.trigger(t.EVENT_CHANGE)});var e='a[href^="#"]';$("#gdk__content ".concat(e)).on(this.EVENT_CLICK,this.onHashAnchorClick),this.$els.tertiary.on(this.EVENT_CLICK,e,this.onHashAnchorClick),_gpdc.Logger.logInitializer("core","common","Hash Anchor Plugin")}},{key:"onHashAnchorClick",value:function(t){var e=$(t.currentTarget).attr("href")||"";if(location.href.includes(e)&&e.length>1)return this.scrollToElementByHash(e),!1}},{key:"onHashChange",value:function(t){var e=window.location.hash;if(e){t.preventDefault();var i=window.htmlEncode(e);return i.includes("?")?void this.sanitizeHashUrl(i):void this.scrollToElementByHash(i)}}},{key:"scrollToElementByHash",value:function(t){t=h(t),t=this.hashRegex.test(t)?t:"#".concat(t);var e=$("".concat(t,', [name="').concat(t.substring(1),'"]')).first();if(e.length){var i=(e.offset().top,this.calculateNavigationOffset());location.href.includes(t)&&s(this.$els.htmlBody,e,i)}}},{key:"highlightTertiaryLink",value:function(){var t=window.location.hash;if(this.$els.html.css("--nav-offset","".concat(this.calculateNavigationOffset(),"px")),!this.pageLoad||!t||"#"===t||!this.$els.tertiary.length)return void(this.pageLoad=!1);var e=window.htmlEncode(t);this.pageLoad=!1;var i=this.$els.tertiary.find(".tertiary-tab__link"),a=this.$els.tertiary.find('.tertiary-tab__link[href="'.concat(e,'"]'));i.length&&a.length&&(i.removeClass("tertiary-tab__link--active"),a.addClass("tertiary-tab__link--active"))}},{key:"calculateNavigationOffset",value:function(){var t=0;return this.$els.dkNav.length&&(t+=this.$els.dkNav.outerHeight()),this.$els.nav.length&&(t+=this.$els.nav.outerHeight()),this.$els.tertiary.length&&(t+=this.$els.tertiary.outerHeight()),t}},{key:"sanitizeHashUrl",value:function(t){var e=t.split("?");if(e){var i="".concat(location.origin).concat(location.pathname);window.location.replace("".concat(i,"?").concat(e[1]||"").concat(e[0]||""))}}}]),e}(),v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.hasClass("tier-tile--subscribed")||!e.isLoggedIn||!e.avatar_url_medium)return void t.find(".tier-tile__avatar").remove();var i=t.find(".tier-tile__avatar"),a=i.find(".tier-tile__avatar-image");a.length&&(a.append('\n            <img src="'.concat(e.avatar_url_medium,'" alt="').concat(e.handle,'" />\n        ')),i.addClass("show"))},p=function(){function e(i){t(this,e),this.userInfo=window._gpdc&&_gpdc.user||{},this.$context=i,this.selector='div[data-component="tier-selector"]',this.hashAnchor=new f,this.$htmlBody=$("html, body"),this.tierTopOffset=28,this.impressedTabs=[]}return i(e,[{key:"init",value:function(){var t=d(this.selector,this.$context);t.length&&$.each(t.find(".tier-tile"),this.process.bind(this)),_gpdc.Logger.logInitializer("accordion","components","Tier Selectors")}},{key:"process",value:function(t,e){var i=this,a=$(e);l(a),v(a,this.userInfo),a.on("click.dkTierSelectorClick",function(){a.addClass("tier-tile--active").attr("aria-expanded",!0),a.siblings().removeClass("tier-tile--active").attr("aria-expanded",!1);var e=a.data("track-js");e&&(_gpdc.analytics.event.addRawEvent(a,e.eventInfo,e.attributes),_gpdc.analytics._satelliteTrack("user_engagement")),r.IS_TABLET_LG.matches||s(i.$htmlBody,a,i.hashAnchor.calculateNavigationOffset()+i.tierTopOffset,!1),i.trackSPOImpression(t,i.getSPOTrackElements(a))});var n=new Waypoint({element:a.get(0),handler:function(){setTimeout(function(){a.hasClass("tier-tile--active")&&i.trackFirstActiveTabImpression(t,a)},200),n.destroy()},offset:"20%"})}},{key:"trackFirstActiveTabImpression",value:function(t,e){var i=this,a=this.getSPOTrackElements(e);if(a.length)return void this.trackSPOImpression(t,a);var n=new MutationObserver(function(){return i.trackSPOImpression(t,i.getSPOTrackElements(e))});n.observe(e.next(".tier-selector__content").find(".tier-selector__batarang").get(0),{attributes:!0,childList:!0,subtree:!0})}},{key:"getSPOTrackElements",value:function(t){return t.next(".tier-selector__content").find('[data-mfe-name="tierSelector"] label.psw-radio [data-track-content="tierSelector:spo"]')}},{key:"trackSPOImpression",value:function(t,e){this.impressedTabs.includes(t)||e.length&&(this.impressedTabs.push(t),$.each(e,function(t,e){var i=$(e),a=i.data(),n=a.track,r=a.telemetryMeta;if(n){var o=n.attributes&&n.attributes.sku||r&&r.skuId||null;_gpdc.analytics.productImpression(o,r),delete n.attributes.sku,_gpdc.analytics.event.addRawEvent(i,n.eventInfo,n.attributes)}}))}}]),e}(),g=function(){function e(i){t(this,e),this.userInfo=window._gpdc&&_gpdc.user||{},this.$context=i,this.selector='div[data-component="comparison-panel"]',this.hashAnchor=new f,this.$htmlBody=$("html, body"),this.tierTopOffset=28}return i(e,[{key:"init",value:function(){var t=this,e=d(this.selector,this.$context);if(e.length){var i=d('div[data-component="tier-selector"]',null);$.each(e.find(".tier-tile"),function(e,a){var n=$(a);l(n),v(n,t.userInfo),t.addBtnClickHandler(n.next(".comparison-panel__content").find("a.btn--cta"),i)})}_gpdc.Logger.logInitializer("accordion","components","Comparison Panels")}},{key:"addBtnClickHandler",value:function(t,e){var i=this;t.length&&t.on("click.dkComparisonPanelCTA",function(a){a.preventDefault();var n=t.data("target-tier"),r=t.attr("href"),o=t.attr("target")||"_self";if(n&&e.length){var c=e.find('.tier-tile[data-tier-id="'.concat(n,'"]'));return void(c.length&&(c.addClass("tier-tile--active").attr("aria-expanded",!0),c.siblings().removeClass("tier-tile--active").attr("aria-expanded",!1),s(i.$htmlBody,c,i.hashAnchor.calculateNavigationOffset()+i.tierTopOffset),i.trackClick(t)))}i.trackClick(t),u(r)&&window.open(r,o)})}},{key:"trackClick",value:function(t){var e=t.data("track-js");if(e){var i=t.data("dtm-label-override"),a=i&&r.IS_TABLET.matches?i:e.attributes.label;e.attributes.label=String(a).trim().replace(/\s+/g,"-").toLowerCase(),_gpdc.analytics.event.addRawEvent(t,e.eventInfo,e.attributes),_gpdc.analytics._satelliteTrack("user_engagement")}}}]),e}(),_=function(){function e(){var i=this;t(this,e),_gpdc.components.Accordion=m,window._gpdc&&_gpdc.user&&"undefined"!=typeof _gpdc.user.isLoggedIn?this.initModules():_gpdc.elements.$document.one("userInfoSet.dkComponents",function(){return i.initModules()})}return i(e,[{key:"initModules",value:function(){(new m).init(),(new p).init(),(new g).init()}}]),e}();!function(t){_gpdc.elements.$document.ready(function(){window._dkDebug=!1;new _})}(jQuery)}();
